#!/bin/bash

#export http_proxy=http://127.0.0.1:1087;export https_proxy=http://127.0.0.1:1087;export ALL_PROXY=socks5://127.0.0.1:1080
export LANG=en_US.UTF-8

# for mbp m1
export BASH_SILENCE_DEPRECATION_WARNING=1

export VISUAL=nvim
export EDITOR="$VISUAL"
export PATH=/sbin:~/bin:$PATH
export PATH=/opt/homebrew/bin:$PATH
# brew install bash coreutils binutils findutils grep gawk gnu-sed
export PATH=/opt/homebrew/opt/coreutils/libexec/gnubin:$PATH
export PATH=/opt/homebrew/opt/binutils/bin:$PATH
export PATH=/opt/homebrew/opt/findutils/libexec/gnubin:$PATH
export PATH=/opt/homebrew/opt/grep/libexec/gnubin/:$PATH
export PATH=/opt/homebrew/opt/ctags/bin:$PATH
export PATH=/opt/homebrew/opt/gnu-tar/libexec/gnubin:$PATH

#TERM=xterm
export STARSHIP_CONFIG="$HOME/.config/starship.toml"
eval "$(starship init bash)"
#PS1='${debian_chroot:+($debian_chroot)}\[\033[1;35m\]\w\[\033[00m\]\n>> '

# for git information of tmux-powerline
#PS1="$PS1"'$([ -n "$TMUX" ] && tmux setenv TMUXPWD_$(tmux display -p "#D" | tr -d %) "$PWD")'

if [ -f $(brew --prefix)/etc/bash_completion ]; then
  . $(brew --prefix)/etc/bash_completion
fi

#All commands have been installed with the prefix 'g'.
#If you do not want the prefix, install using the "with-default-names" option.
#
#If you need to use these commands with their normal names, you
#can add a "gnubin" directory to your PATH from your bashrc like:
#
#    PATH="/usr/local/opt/make/libexec/gnubin:$PATH"
#
#Additionally, you can access their man pages with normal names if you add
#the "gnuman" directory to your MANPATH from your bashrc as well:
#
#    MANPATH="/usr/local/opt/make/libexec/gnuman:$MANPATH"

#curl https://raw.githubusercontent.com/git/git/master/contrib/completion/git-completion.bash -o ~/.git-completion.bash
source ~/.git-completion.bash

alias vim="nvim"
alias vi="nvim"
alias d="sdcv"
alias ls='gls --color=auto'
alias ll='gls --color=auto -l'
alias la='gls --color=auto -A'
alias l='gls --color=auto -CF'
alias rr='xset r rate 250 50'
alias rm='grm'
alias cp='gcp'
alias sed='gsed'
#alias rsync='rsync --filter=":- ~/.gitignore_global"'
alias chrome="open -a 'Google Chrome'"
alias tree="tree -C"

_cx_collect_mcp_names() {
  local cfg="$HOME/.codex/config.toml"
  [ -f "$cfg" ] || return 0
  awk '
    /^\[mcp_servers\./ {
      name=$0
      sub(/^\[mcp_servers\./, "", name)
      sub(/\]$/, "", name)
      gsub(/"/, "", name)
      print name
    }
  ' "$cfg" | sort -u
}

_cx_build_mcp_flags() {
  local state="$1"
  CX_MCP_FLAGS=()
  local name
  while IFS= read -r name; do
    [ -n "$name" ] || continue
    CX_MCP_FLAGS+=("-c" "mcp_servers.${name}.enabled=${state}")
  done < <(_cx_collect_mcp_names)
}

_cx_run() {
  local enable_mcp="$1"
  shift
  printenv OPENAI_API_KEY | codex login --with-api-key
  _cx_build_mcp_flags "$enable_mcp"
  codex "${CX_MCP_FLAGS[@]}" "$@"
}

alias cx="_cx_run false"
#alias cx1="_cx_run false --dangerously-bypass-approvals-and-sandbox -m gpt-5.3-codex-spark"
alias cx1="_cx_run false --dangerously-bypass-approvals-and-sandbox -c model_reasoning_effort=low"
alias cx2="_cx_run false --dangerously-bypass-approvals-and-sandbox -c model_reasoning_effort=medium"
alias cx3="_cx_run true --dangerously-bypass-approvals-and-sandbox -c model_reasoning_effort=xhigh"
alias cc="claude"
alias cc2="claude --dangerously-skip-permissions"
alias oc="opencode"

#OS X Terminal equivalent of Ctrl+Left / Ctrl+Right
#https://apple.stackexchange.com/questions/1626/os-x-terminal-equivalent-of-ctrlleft-ctrlright
bind '"\e[5C": forward-word'
bind '"\e[5D": backward-word'
bind '"\e[1;5C": forward-word'
bind '"\e[1;5D": backward-word'

[ -e ~/.bashrc_ignored ] && . ~/.bashrc_ignored

_vps="-p 33333 root@8.220.207.192"
_vps2="-p 33333 root@8.222.225.241"
_nas="-6 -p 33333 hh123okbb@zaozaoxixi.synology.me"
_nas2="-6 -p 33333 hh123okbb@zaozaoxixi.top"

g() {
  set -x
  target="_$1"
  ssh ${!target}
  set +x
}

# XXX KNOWN ISSUES
# For bash users, autojump keeps track of directories by modifying $PROMPT_COMMAND. Do not overwrite $PROMPT_COMMAND
[[ -s ~/.autojump/etc/profile.d/autojump.sh ]] && source ~/.autojump/etc/profile.d/autojump.sh
[ -f /opt/homebrew/etc/profile.d/autojump.sh ] && . /opt/homebrew/etc/profile.d/autojump.sh
alias s='j -s'
